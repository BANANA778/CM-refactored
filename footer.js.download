/*global $, STN*/
$(function () {
	"use strict";
	
	var bundle, closer, bodyClick, newFooter, stnFooter;
	
	newFooter = $('#newfooter');
	stnFooter = $('#stn-footer-hide');
	
	bundle = [];
	
	$('a.footerlink', newFooter).each(function (key, link) {
		var strName = (link.id.split('-')[1]),
			page = $('#footer-' + strName),
			$link = $(link);
		
		bundle.push({
			'link': $link,
			'page': page,
			'closeSpan': $('span.close', page)
		});
		
		if ($link.hasClass('no-ajax')) {
			return;
		}
		
		$link.one('mouseover', function (e) {
			var pg = page,
				url = STN.live_site + '/footer/' + strName + '.html';
			
			$.get(url, function (data) {
				pg.html(data);
			});
		});
	});
	
	closer = function () {
		$.each(bundle, function (key, item) {
			item.page.removeClass('stn-footer-show');
		});
	};
	
	bodyClick = function (e) {
		var target = $(e.target);
		
		if (target.is('#newfooter *') || target.is('#stn-footer-hide *')) {
			return;
		} else {
			closer();
			$(document.body).unbind('click', bodyClick);
		}
	};
	
	$.each(bundle, function (key, item) {
		item.link.bind('click', function (e) {
			e.preventDefault();
			e.stopPropagation();
			
			closer();
			
			if (!item.page.hasClass('stn-footer-show')) {
				item.page.addClass('stn-footer-show');
				$(document.body).bind('click', bodyClick);
			}
		});
	});
	
	$('#footerwrap').delegate('span.close', 'click', closer);
});

